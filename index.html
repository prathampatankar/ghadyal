<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>घड्याळ</title>
    <link rel="icon" type="image/x-icon" href="ghadyallogo.svg">
    <link rel=manifest href=manifest.json>
    <script src="ical.js"></script>
    <script src="fitty.min.js"></script>
    <style>
        @font-face {
            font-family: krutidev;
            src: url('krutidev.ttf');
        }
        body {
            margin: 0;
            padding: 0;
            /* overflow-y: hidden; */
            background-color: white;
        }
        .vel {
            width: auto;
            background-color: black;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            /* font-size: 1500%; */
            line-height: .8;
            gap: 16px;
            border-radius: 50px;
            margin: 8px;
            margin-bottom: 0;
            flex: 1 0 0;
            padding: 16px;
        }
        .calender {
            width: auto;
            background-color: black;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 12px;
            border-radius: 50px;
            margin: 8px;
            margin-top: 0;
            flex: 1 0 0;
            line-height: .8;
            padding: 16px;
        }
        #mahina, #vaar {
            font-size: 5vh;
            line-height: 1;
        }
        #tarikh {
            font-size: 1500%;
            line-height: 1;
        }
        .divider {
            height: 4px;
            background-color: white;
        }
        .borderup, .borderdown, .borderleft, .borderright{
            position: fixed;
            z-index: 20;
               
        }
        #event {
            position: relative;
            margin-left: auto;
            background-color: white;
            color: black;
            padding: 12px 8px;
            border-radius: 50px;
            max-width: 80px; 
        }
        .container {
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 8px;
            
        }
        #event {
            font: krutidev;
        }
        @media (orientation: landscape) {
        .container {
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: c;
            gap: 8px;
        }
        .vel {
            margin: 8px;
            margin-right: 0;
        }
        .calender {
            margin: 8px;
            margin-left: 0;
        }
        #tarikh {
            line-height: 1;
        }
      }
    </style>
</head>
<body>
    <!-- <div class="borderup"></div>
    <div class="borderdown"></div>
    <div class="borderleft"></div>
    <div class="borderright"></div> -->
    <div class="container">
        <div class="vel">
            <div id="taas"></div>
            <div id="minutes"></div>
        </div>
        <!-- <div class="divider"></div> -->
        <div class="calender">
            <div id="event"></div>
            <div id="mahina"></div>
            <div id="tarikh"></div>
            <div id="vaar"></div>
        </div>
    </div>
    <script>
        fitty('#taas,#minutes,#tarikh',{
            minSize: 16,
            maxSize: 200,
        });
        setInterval(()=>{
        const currentTime = new Date()
        let taas = (currentTime.getHours())
        if(taas>12){
            taas = taas - 12;
        }
        let taas2 = (taas).toLocaleString("hi-u-nu-deva")
        let minutes = ((currentTime.getMinutes())).toLocaleString("hi-u-nu-deva")
        let mahina = (currentTime.getMonth())
        let tarikh = ((currentTime.getDate())).toLocaleString("hi-u-nu-deva")
        let vaar = (currentTime.getDay())
        if(mahina == 0){
            document.getElementById("mahina").innerHTML = "जानेवारी";
        }else if(mahina == 1){
            document.getElementById("mahina").innerHTML = "फेब्रुवारी";
        }else if(mahina == 2){
            document.getElementById("mahina").innerHTML = "मार्च";
        }else if(mahina == 3){
            document.getElementById("mahina").innerHTML = "एप्रिल";
        }else if(mahina == 4){
            document.getElementById("mahina").innerHTML = "मे";
        }else if(mahina == 5){
            document.getElementById("mahina").innerHTML = "जून";
        }else if(mahina == 6){
            document.getElementById("mahina").innerHTML = "जुलै";
        }else if(mahina == 7){
            document.getElementById("mahina").innerHTML = "ऑगस्ट";
        }else if(mahina == 8){
            document.getElementById("mahina").innerHTML = "सप्टेंबर";
        }else if(mahina == 9){
            document.getElementById("mahina").innerHTML = "ऑक्टोबर";
        }else if(mahina == 10){
            document.getElementById("mahina").innerHTML = "नोव्हेंबर";
        }else if(mahina == 11){
            document.getElementById("mahina").innerHTML = "डिसेंबर";
        }
        if(vaar == 0){
            document.getElementById("vaar").innerHTML = "रविवार";
        }else if(vaar == 1){
            document.getElementById("vaar").innerHTML = "सोमवार";
        }else if(vaar == 2){
            document.getElementById("vaar").innerHTML = "मंगळवार";
        }else if(vaar == 3){
            document.getElementById("vaar").innerHTML = "बुधवार";
        }else if(vaar == 4){
            document.getElementById("vaar").innerHTML = "गुरुवार";
        }else if(vaar == 5){
            document.getElementById("vaar").innerHTML = "शुक्रवार";
        }else if(vaar == 6){
            document.getElementById("vaar").innerHTML = "शनिवार";
        }
        document.getElementById("taas").innerHTML = taas2;
        document.getElementById("minutes").innerHTML = minutes;
        document.getElementById("tarikh").innerHTML = tarikh;
        },1000)
        const today = new Date();
        if (today.getDate() === 4 && today.getMonth() === 11){
            console.log('kiki yes')
            const eventElement = document.getElementById('event');
            eventElement.textContent =  `(test event on)`;
        }
        if('serviceWorker' in navigator){
            navigator.serviceWorker
            // give complete path of sw.js file
            .register('http://127.0.0.1:5500/service-worker.js')
            .then(() => console.log('Service Worker Registered'))
        }

        let deferredPromt;
        const addBtn = document.querySelector('.installApp')
        // addBtn.style.display = 'none'

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPromt = e;
            addBtn.style.display = 'block'

            addBtn.addEventListener('click', () => {
                addBtn.style.display = 'none';
                deferredPromt.prompt();
                deferredPromt.userChoice.then((choiceResult) => {
                    if(choiceResult.outcome === 'accepted'){
                        console.log('App is installing');
                    }else{
                        console.log('User dismissed the prompt');
                    }
                    deferredPromt = null;
                })
            })
        })
        // // Function to fetch and extract event details from the ICS file
        // async function fetchAndExtractEventDetails(url) {
        // try {
        //     // Fetch the ICS file
        //     const response = await fetch(url);

        //     if (!response.ok) {
        //     throw new Error(`Failed to fetch ICS file (HTTP ${response.status})`);
        //     }

        //     const icsData = await response.text();

        //     // Extract DTSTART, SUMMARY, and DESCRIPTION using regular expressions
        //     const dtStartRegex = /DTSTART;VALUE=DATE:([\d]+)/g;
        //     const summaryRegex = /SUMMARY:([^\n]+)/;

        //     const events = [];

        //     let match;
        //     while ((match = dtStartRegex.exec(icsData)) !== null) {
        //     const dtStart = match[1];
        //     const summaryMatch = icsData.substring(match.index).match(summaryRegex);
        //     const summary = summaryMatch ? summaryMatch[1] : 'No Summary';

        //     events.push({ dtStart, summary });
        //     }

        //     return events;
        // } catch (error) {
        //     console.error('Error fetching or extracting event details:', error.message);
        // }
        // }

        // // Function to check if the current date matches any event date
        // function checkEventDate(events) {
        // const currentDate = new Date();
        // const currentDateString = currentDate.toISOString().split('T')[0].replace(/-/g, '');

        // const matchingEvent = events.find(event => event.dtStart === currentDateString);

        // const eventDiv = document.getElementById('event');
        // eventDiv.innerHTML = (`(${matchingEvent.summary})`).toLocaleString("hi-u-nu-deva");
        // if (matchingEvent) {
        //     console.log(`Event Summary: ${matchingEvent.summary}`);
        // } else {
        //     console.log('No matching event for today.');
        // }
        // }

        // // Replace 'YOUR_ICS_FILE_URL' with the actual URL of your ICS file
        // const icsFileUrl = 'test.ics';

        // // Fetch and extract event details, then check for today's event
        // fetchAndExtractEventDetails(icsFileUrl)
        // .then(events => checkEventDate(events))
        // .catch(error => console.error('Error:', error));

    </script>
</body>
</html>
